<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8" content="text/html"/>
    <!--<meta name="_csrf" th:content="${_csrf.token}"/>-->
    <!--<meta name="_csrf_header" th:content="${_csrf.headerName}"/>-->
    <title>Maps</title>

    <!--WORKING IN SITE-->
    <link rel="stylesheet"  th:href="@{/webjars/bootstrap/3.3.7/css/bootstrap.min.css}"
          type="text/css" media="screen" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

    <script type="text/javascript"
            src="/webjars/bootstrap/3.3.7/js/bootstrap.min.js"
            th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/simple-left-sidebar.css}"
          href="/static/css/simple-left-sidebar.css" type="text/css" media="screen" />

    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>

    <!--STYLES FOR WRAPPED MENU-->
    <style th:inline="text">
        .sidebar-wrapper {
            z-index: 1000;
            position: fixed;
            top:0;
            width: 30%;
            height: 100%;
            overflow-y: auto;
            /*background: #222;*/
            /*background: #ddd;*/
            /*background: #4060A5;*/
            background: rgba(64, 96, 165, 0.9);
            -webkit-transition: all 0.4s ease-in-out 0s;
            -moz-transition: all 0.4s ease-in-out 0s;
            -ms-transition: all 0.4s ease-in-out 0s;
            -o-transition: all 0.4s ease-in-out 0s;
            transition: all 0.4s ease-in-out 0s;
        }
        .sidebar-nav {
            position: absolute;
            top: 8.2%;
            width: 100%;
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .sidebar-nav>li {
            position: relative;
            line-height: 20px;
            display: inline-block;
            width: 100%;
            font-size: 110%;
            font-weight: 800;
            text-transform: uppercase;
            outline: none;
        }
        .sidebar-nav>li:before {
            content: '';
            position: absolute;
            top: 0;
            z-index: -1;
            height: 100%;
            width: 3px;
            background-color: #1c1c1c;
            -webkit-transition: width .4s ease-in-out;
            -moz-transition: width .4s ease-in-out;
            -ms-transition: width .4s ease-in-out;
            transition: width .4s ease-in-out;
        }
        .sidebar-nav>li:first-child a {
            /*color: #fff;*/
            background-color: #1a1a1a;
        }
        .sidebar-nav>li:nth-child(2):before {
            /*color: #fff;*/
            /*background-color: #279636;*/
            background-color: #449d44;
            border: 1px solid #398439;
        }

        .sidebar-nav>li:nth-child(3):before {
            /*color: #fff;*/
            /*background: #FEA501;*/
            /*background: #edeea7;*/
            background: rgba(20, 37, 86, 0.8);
            border: 1px solid rgba(20, 37, 86, 1);
            /*border: 1px solid #FEA501;*/
        }
        .sidebar-nav>li:nth-child(4):before {
            background-color: #79aefe;
        }
        .sidebar-nav>li:nth-child(5):before {
            background-color: #314190;
        }
        .sidebar-nav>li:nth-child(6):before {
            background-color: #ec1b5a;
        }
        .sidebar-nav>li:nth-child(7):before {
            background-color: #7d5d81;
        }
        .sidebar-nav>li:nth-child(8):before {
            background-color: #ead24c;
        }
        .sidebar-nav>li:nth-child(9):before {
            background-color: #2d2366;
        }
        .sidebar-nav>li:nth-child(10):before {
            background-color: #35acdf;
        }
        .sidebar-nav>li:nth-child(11):before {
            /*color: #fff;*/
            background-color: #808080;
        }
        .sidebar-nav>li:hover:before, .sidebar-nav>li.open:hover:before {
            width: 100%;
            -webkit-transition: width .4s ease-in-out;
            -moz-transition: width .4s ease-in-out;
            -ms-transition: width .4s ease-in-out;
            transition: width .4s ease-in-out;
        }
        .sidebar-nav>li a {
            display: block;
            /*color: #ddd;*/
            color: #f4f4f4;
            /*color: #222;*/
            text-decoration: none;
            padding: 10px 15px 10px 30px;
        }
        .sidebar-nav>li a:hover, .sidebar-nav>li a:active, .sidebar-nav>li a:focus, .sidebar-nav>li.open a:hover, .sidebar-nav>li.open a:active, .sidebar-nav>li.open a:focus {
            color: #fff;
            text-decoration: none;
            background-color: transparent;
        }
        .sidebar-nav > .sidebar-brand {
            height: 44px;
            font-size: 18px;
            line-height: 1.43;
        }
        .sidebar-nav > .dropdown-menu {
            position: relative;
            width: 100%;
            padding: 0;
            margin: 0;
            border-radius: 0;
            border: none;
            background-color: #222;
            box-shadow: none;
        }
        .menu-toggle{
            z-index: 801;
            /*position: fixed;*/
            /*top: 0;*/
            /*left: .5%;*/
        }
        .sidebar-wrapper.active {
            -webkit-transition: all 0.4s ease 0s;
            -moz-transition: all 0.4s ease 0s;
            -ms-transition: all 0.4s ease 0s;
            -o-transition: all 0.4s ease 0s;
            transition: all 0.4s ease 0s;
        }
        .toggle {
            margin: 0;
        }
        .btn-dark {
            border-radius: 0;
            color: #fff;
            background-color: rgba(0,  0,  0,  0.4);
        }
        .btn-dark:hover, .btn-dark:focus, .btn-dark:active {
            color: #fff;
            background-color: rgba(0,  0,  0,  0.7);
        }
        .btn-light {
            border-radius: 0;
            color: #333;
            background-color: rgb(255,  255,  255);
        }
        .btn-light:hover, .btn-light:focus, .btn-light:active {
            color: #333;
            background-color: rgba(255,  255,  255,  0.8);
        }
        .btn {
            border-radius: 0px;
            overflow: hidden;
            border:none;
        }
        .btn-success:hover, .btn-success:focus, .btn-success.focus, .btn-success:active, .btn-success.active, .open > .dropdown-toggle.btn-success {
            color: #fff;
            background-color: #449d44;
            border-color: #398439;
            box-shadow: inset 0 0 0 2px #398439;
        }
        .btn-danger:hover, .btn-danger:focus, .btn-danger.focus, .btn-danger:active, .btn-danger.active, .open > .dropdown-toggle.btn-danger {
            color: #fff;
            background-color: #c9302c;
            border-color: #ac2925;
            box-shadow: inset 0 0 0 2px #ac2925;
        }
        .btn-primary:hover, .btn-primary:focus, .btn-primary.focus, .btn-primary:active, .btn-primary.active, .open > .dropdown-toggle.btn-primary {
            color: #fff;
            background-color: #286090;
            border-color: #204d74;
            box-shadow: inset 0 0 0 2px #204d74;
        }
        .btn-default {
            color: #333;
            background-color: #efefef;
            border-color: #ccc;
        }
        .btn-default:hover, .btn-default:focus, .btn-default.focus, .btn-default:active, .btn-default.active, .open > .dropdown-toggle.btn-default {
            color: #333;
            background-color: #e6e6e6;
            border-color: #adadad;
            box-shadow: inset 0 0 0 5px #adadad;
        }
        .btn-inverse {
            background-color: #222;
            border-color: #080808;
            color: #9d9d9d;
        }
        .btn-inverse:hover, .btn-inverse:focus, .btn-inverse.focus, .btn-inverse:active, .btn-inverse.active, .open > .dropdown-toggle.btn-inverse {
            color: #fff;
            background-color: #080808;
            border-color: #333;
            box-shadow: inset 0 0 0 2px #333;
        }
        .btn-danger:hover, .btn-danger:focus, .btn-danger.focus, .btn-danger:active, .btn-danger.active, .open > .dropdown-toggle.btn-danger {
            color: #fff;
            background-color: #c9302c;
            border-color: #ac2925;
            box-shadow: inset 0 0 0 2px #ac2925;
        }
        .btn-danger.active, .btn-danger.focus, .btn-danger:active, .btn-danger:focus, .btn-danger:hover, .open>.dropdown-toggle.btn-danger {
            color: #c9302c;
            background-color: #fff;
            box-shadow: inset 0 0 0 2px #c9302c;
            border-color: #ac2925;
        }
        /*.btn-dark{*/
            /*border-radius: 0;*/
            /*color: #fff;*/
            /*background-color: rgba(0,0,0,0.4);*/
        /*}*/
        /*.btn-dark:hover,*/
        /*.btn-dark:focus,*/
        /*.btn-dark:active,*/
        /*.btn-dark.active{*/
            /*color: #fff;*/
            /*background-color: rgba(0,0,0,0.7);*/
        /*}*/

        /********************************/
        /*          Custom Buttons      */
        /********************************/
        .btn.btn-lg {padding: 10px 40px;}

    </style>

    <!--STYLES FOR RIGHT MENU-->
    <style th:inline="text">
        #sidebar-wrapper-right{
            position: fixed;
            top:0;
            /*width: 30%;*/
            /*height: 100%;*/
            right: 0;
            margin-right: -30%;
        }
        .wrapper-right li:before {
            right: 0;
        }
        #sidebar-wrapper-right.active {
            right: 30%;
            width: 30%;
        }
        #right-menu-toggle {
            position: fixed;
            top: 0;
            right: .5%;
        }
    </style>

    <!--STYLES FOR LEFT MENU-->
    <style th:inline="text">
        #sidebar-wrapper-left{
            position: fixed;
            top:0;
            /*width: 30%;*/
            /*height: 100%;*/
            left: 0;
            margin-left: -30%;
        }
        .wrapper-left li:before {
            left: 0;
        }
        #sidebar-wrapper-left.active {
            left: 30%;
            width: 30%;
        }
        #left-menu-toggle {
            position: fixed;
            top: 0;
            left: .5%;
        }

        .empty_list{
            padding: 0.2em 0.2em;
            width: 100%;
            text-align: center;
            color: #FFFFFF;
        }

        .elem-in-list{
            -webkit-border-radius: 0.2em;
            -moz-border-radius: 0.2em;
            border-radius: 0.2em;
            width: 90%;
            border: 1px solid #204d74;
            /*border: 1px solid #398439;*/
            /*border: 1px solid #0094BC;*/
            padding: 0.2em 0;
            margin-bottom: 0.5em;
            cursor: pointer;
        }

        #tasksListBlock{
            padding: 1em 0;
        }

        .elemFromList-GeoPoints {
            /*background: #449d44;*/
            background: rgba(71, 164, 71, 0.7);
        }
        .elemFromList-GeoPoints:hover {
            /*background: #449d44;*/
            background: rgba(68,157,68,1);
        }

        div.ListTasksOwner,
        .elemFromList-TasksOwner {
            /*background: #FEA501;*/
            /*background: rgba(249,182,63,0.7);*/
            /*background: #edeea7;*/
            background: rgba(241,196,15,0.7);
        }
        .elemFromList-TasksOwner:hover {
            /*background: #f1c40f;*/
            background: rgba(241,196,15,1);
        }

        div.ListTasksLocal,
        .elemFromList-TasksLocal {
            /*background: #e88845;*/
            background: rgba(217, 83, 79, 0.7)
        }
        .elemFromList-TasksLocal:hover {
            background: rgba(217, 83, 79, 1)
        }

        div.ListTasksSubscribed,
        .elemFromList-TasksSubscribed {
            /*background: #337ab7*/
            background: rgba(51, 122, 183, 0.7);
        }
        .elemFromList-TasksSubscribed:hover {
            background: rgba(51, 122, 183, 1);
        }

        div.ListTasksRecent,
        .elemFromList-TasksRecent {
            /*background: #5bc0de;*/
            background: rgba(91, 192, 222, 0.7);
        }
        .elemFromList-TasksRecent:hover {
            background: rgba(91, 192, 222, 1);
        }

        div.ListTasksChart,
        .elemFromList-TasksChart {
            /*background: #f0ad4e;*/
            background: rgba(232, 136, 69, 0.7)
        }
        .elemFromList-TasksChart:hover {
            background: rgba(232, 136, 69, 1)
        }

    </style>

    <!--STYLES FOR CHECKBOXES for TASKS LISTS-->
    <style th:inline="text">
        .material-switch > input[type="checkbox"] {
            display: none;
        }

        .material-switch > label {
            cursor: pointer;
            height: 0px;
            position: relative;
            width: 40px;
        }

        .material-switch > label::before {
            background: rgb(0, 0, 0);
            box-shadow: inset 0px 0px 10px rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            content: '';
            height: 16px;
            margin-top: -8px;
            position:absolute;
            opacity: 0.3;
            transition: all 0.4s ease-in-out;
            width: 40px;
        }
        .material-switch > label::after {
            background: rgb(255, 255, 255);
            border-radius: 16px;
            box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.3);
            content: '';
            height: 24px;
            left: -4px;
            margin-top: -8px;
            position: absolute;
            top: -4px;
            transition: all 0.3s ease-in-out;
            width: 24px;
        }
        .material-switch > input[type="checkbox"]:checked + label::before {
            background: inherit;
            opacity: 0.5;
        }
        .material-switch > input[type="checkbox"]:checked + label::after {
            background: inherit;
            left: 20px;
        }
    </style>

    <!--STYLES FOR Vertical Lists-->
    <style th:inline="text">

        #accordion-left.accordion-toggle, #accordion-left.social {
            top: 4em;
            left: .5%;
        }
        #accordion-right .accordion-toggle, #accordion-right.social {
            top: 4em;
            right: .5%;
        }
        #accordion-right>div>ul>li>a{
            right: 1em;
        }
        .accordion-toggle{
            z-index: 801;
            position: fixed;
            /*top: 4em;*/
            /*top: 0;*/
            /*left: .5%;*/
        }

        .accordion-toggle:hover, .accordion-toggle:focus{
            cursor:pointer;
        }

        .social {
            z-index: 801;
            position: fixed;
            /*top: 4em;*/
            /*top: 10%;*/
            /*left: .5%;*/
            padding: 0;
            margin: 0;
            font-size: 100%;
            width:2.7%;
        }
        .social ul {
            background: #4060A5;
        }
        .social ul li {
            list-style: none outside none;
            display: block;
            background: #222;
            padding: 0;
            margin: 0;
        }

        /*.nav>li>a:focus, .nav>li>a:hover {*/
        /*text-decoration: none;*/
        /*background-color: #222;*/
        /*}*/
        .social i {
            width:100%;
            min-width: 50px;
            height: 100%;
            min-height: 50px;
            color: #FFF;
            background-color: #222;
            font-size: 22px;
            text-align: center;
            padding-top: 12px;
            -webkit-transition: all ease 0.3s;
            -moz-transition: all ease 0.3s;
            -ms-transition: all ease 0.3s;
            -o-transition: all ease 0.3s;
            transition: all ease 0.3s;
        }
        .social .fa-map-marker:hover, .social .fa-tags:hover {
            background: #449d44;
            border: 1px solid #398439;
        }
        .social .fa-stack-exchange:hover, .social .fa-tasks:hover {
            /*background: #FEA501;*/
            /*color: #9d9d9d;*/
            /*background: #808080;*/
            /*background: #edeea7;*/
            background: rgba(20, 37, 86, 0.8);
            /*border: 1px solid #f6a001;*/
            /*border: 1px solid #eeec99;*/
            border: 1px solid rgba(20, 37, 86, 1);
        }
        .social .fa-map-marker:hover {
            background: #449d44;
            border: 1px solid #398439;
        }
        .social .fa-facebook:hover {
            background: #4060A5;
            border: 1px solid #4060A5;
        }
        .social .fa-twitter:hover {
            background: #00ABE3;
            border: 1px solid #00ABE3;
        }
        .social .fa-google-plus:hover {
            background: #e64522;
            border: 1px solid #e64522;
        }
        .social .fa-github:hover {
            background: #343434;
            border: 1px solid #343434;
        }
        .social .fa-linkedin:hover {
            background: #0094BC;
            border: 1px solid #0094BC;
        }
        .social .fa-stack-overflow:hover {
            background: #FEA501;
            border: 1px solid #FEA501;
        }
        .social .fa-skype:hover {
            background: #00C6FF;
            border: 1px solid #00C6FF;
        }
        /*.social .fa-stack-exchange:hover {*/
        /*background: #4D86C9;*/
        /*border: 1px solid #4D86C9;*/
        /*}*/
        .social .fa-rss:hover {
            background: #e88845;
            border: 1px solid #e88845;
        }
        #social-collapse:after {
            font-family: 'FontAwesome';
            content: "\f068";
            float: none;
            position: relative;
            color: white;
        }
        #social-collapse.collapsed:after {
            content: "\f067";
        }

        /*
        ========================
        Social Accordion Styling
        ========================
        */
        .nav-stacked > li > a {
            position: relative;
            display: block;
            padding: 0!important;
            margin: 0!important;
        }
        .nav-stacked > li > a:focus, .nav-stacked > li > a:hover {
            text-decoration: none;
            background-color: #222;
        }

        .nav-tabs.nav-justified {
            border-bottom: 0 none;
            width: 100%;
        }

        .nav-tabs.nav-justified > li {
            display: table-cell;
            width: 1%;
            float: none;
        }

        .container-form .nav-tabs.nav-justified > li > a, .container-form .nav-tabs.nav-justified > li > a:hover, .container-form .nav-tabs.nav-justified > li > a:focus {
            background: #333333;
            border: 0 none;
            color: #ffffff;
            margin-bottom: 0;
            margin-right: 0;
            border-radius: 0;
            padding: 6% 3%;
            line-height: 1.5;
            font-weight: 600;
            font-size: 100%;
            outline: 0 none;
        }

    </style>

    <!--STYLES FOR MAP-->
    <style th:inline="text">
        #map {
            width: 100%;
            height: 100%
        }
        .main-container {
            display: block;
            position: relative;
            width: 90%;
            height: 100%;
            /*padding-right: 15px;*/
            /*padding-left: 15px;*/
            padding-top: 50px;
            margin-right: auto;
            margin-left: auto;

            overflow: hidden;
        }
        /*@media (min-width: 768px) {*/
        /*.main-container {*/
        /*width: 750px*/
        /*}*/
        /*}*/
        /*@media (min-width: 992px) {*/
        /*.main-container {*/
        /*width: 970px*/
        /*}*/
        /*}*/
        /*@media (min-width: 1200px) {*/
        /*.main-container {*/
        /*width: 1170px*/
        /*}*/
        /*}*/
    </style>

    <!--STYLES FOR MESSAGES-->
    <style th:inline="text">
        /*#responseMessage {*/
            /*background-color: #fff;*/
            /*color: #0074D9;*/
        /*}*/
        #message-add_place {
            background-color: #0074D9;
            color: #fff;
        }
        .Message--orange {
            background-color: #F39C12;
        }

        .Message--red {
            background-color: #FF4136;
        }

        .Message--green {
            background-color: #2ECC40;
        }

        #message-info.Message{
            top: 4em;
            background-color: #0074D9;
            color: #fff;
        }
        #message-info.Message.is-hidden{
            top: -250px;
        }
        .Message {
            display: table;
            position: fixed;
            /*left:0;*/
            left:calc(50% - 250px);
            bottom: 1em;
            margin: 0 auto;
            /*margin: 40px auto 0;*/
            width: 500px;
            -webkit-transition: all 0.4s ease;
            transition: all 0.4s ease;
            -webkit-animation: opacity 0.5s ease-out;
            -moz-animation: opacity 0.5s ease-out;
            -o-animation: opacity 0.5s ease-out;
            animation: opacity 0.5s ease-out;
        }
        .Message.is-hidden {
            opacity: 0;
            height: 0;
            margin-bottom: -250px;
            font-size: 0;
            padding: 0;
            /*margin: 0 auto;*/
            display: block;
            -webkit-transition: all 0.4s ease;
            transition: all 0.4s ease;
            -webkit-animation: opacity 0.5s ease-out;
            -moz-animation: opacity 0.5s ease-out;
            -o-animation: opacity 0.5s ease-out;
            animation: opacity 0.5s ease-out;
        }
        .Message-icon {
            display: table-cell;
            vertical-align: middle;
            width: 60px;
            padding: 30px;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.25);
        }
        .Message-icon > i {
            width: 20px;
            font-size: 20px;
        }

        .Message-body {
            display: table-cell;
            vertical-align: middle;
            padding: 30px 20px 30px 10px;
        }
        .Message-body > p {
            line-height: 1.2;
            margin-top: 6px;
        }

        .Message-button {
            position: relative;
            margin: 15px 5px -10px;
            background-color: rgba(0, 0, 0, 0.25);
            box-shadow: 0 3px rgba(0, 0, 0, 0.4);
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-family: 'Source Sans Pro';
            color: #fff;
            outline: none;
            cursor: pointer;
        }
        .Message-button:hover {
            background: rgba(0, 0, 0, 0.3);
        }
        .Message-button:active {
            background: rgba(0, 0, 0, 0.3);
            box-shadow: 0 0px rgba(0, 0, 0, 0.4);
            top: 3px;
        }

        .Message-close {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.3);
            color: #fff;
            border: none;
            outline: none;
            font-size: 20px;
            right: 5px;
            top: 5px;
            opacity: 0;
            cursor: pointer;
        }
        .Message:hover .Message-close {
            opacity: 1;
        }
        .Message-close:hover {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .u-italic {
            font-style: italic;
        }


    </style>

    <!--STYLES FOR CHANGING FORMS IN RIGHT MENU-->
    <style th:inline="text">
        .geo_point-button {
            width:49%;
        }

        #geoPointListBlock>ul {
            color: #fff;
        }
    </style>

</head>
<body>

<!--HEADER-->
<div th:replace="fragments/header :: header"> </div>
<!--MAIN MAP CONTAINER-->
<div class="main-container">

    <!--yMaps-->
    <div id="map" style="width: 90vw; height: 90vh"></div>
    <!--<div id="map" style="position: relative;display: block;width: 100%; height: 100%"></div>-->


    <!--<script th:src="@{/ymaps.js}"></script>-->
    <script  type="text/javascript" th:src="@{/js/ymaps.js}" src="/static/js/ymaps.js"></script>

    <!--OBJECTS TO MAP-->
    <script th:inline="javascript">
        /*<![CDATA[*/
        /*twirl#houseIcon
        * twirl#darkgreenDotIcon*/
        var groups = [
            {
                name: "GeoPoints",
                style: 'islands#darkGreenIcon',
                styleCircle: {
                    // Прозрачность заливки.
                    fillColor: "#2bce4e",
                    // Прозрачность заливки.
                    fillOpacity: 0.3,
                    // Цвет обводки.
                    strokeColor: "#27bb47",
                    // Прозрачность обводки.
                    strokeOpacity: 0.5,
                    // Ширина обводки в пикселях.
                    strokeWidth: 1
                },
                items: [
                    {
                        id:1,
                        descr: 'Тестовая точка м.Адмиралтейская',
                        latitude: 59.93674,
                        longitude: 30.3117,
                        radius: 200
                    },
                    {
                        id:2,
                        descr: 'Тестовая точка м.Пл.А.Невского',
                        latitude: 59.925544,
                        longitude: 30.389422,
                        radius: 80
                    }
                ],
                placemarkCollection: null,
                circleCollection: null
            },
            /*twirl#bankIcon
            * twirl#whiteDotIcon*/
            {
                name: "TasksOwner",
                style: 'islands#yellowIcon',
                styleCircle: {
                    // Прозрачность заливки.
                    fillColor: "#ecf071",
                    // Прозрачность заливки.
                    fillOpacity: 0.3,
                    // Цвет обводки.
                    strokeColor: "#efed15",
                    // Прозрачность обводки.
                    strokeOpacity: 0.5,
                    // Ширина обводки в пикселях.
                    strokeWidth: 1
                },
                items: [
                ],
                placemarkCollection: null,
                circleCollection: null
            },
            {
                name: "TasksLocal",
                style: 'islands#redIcon',
                styleCircle: {
                    // Прозрачность заливки.
                    fillColor: "#f0a561",
                    // Прозрачность заливки.
                    fillOpacity: 0.3,
                    // Цвет обводки.
                    strokeColor: "#ef8a6f",
                    // Прозрачность обводки.
                    strokeOpacity: 0.5,
                    // Ширина обводки в пикселях.
                    strokeWidth: 1
                },
                items: [

                ],
                placemarkCollection: null,
                circleCollection: null
            },
            {
                name: "TasksSubscribed",
                style: 'islands#darkBlueIcon',
                styleCircle: {
                    // Прозрачность заливки.
                    fillColor: "#84bfe2",
                    // Прозрачность заливки.
                    fillOpacity: 0.3,
                    // Цвет обводки.
                    strokeColor: "#72b5c2",
                    // Прозрачность обводки.
                    strokeOpacity: 0.5,
                    // Ширина обводки в пикселях.
                    strokeWidth: 1
                },
                items: [

                ],
                placemarkCollection: null,
                circleCollection: null
            },
            {
                name: "TasksRecent",
                style: 'islands#lightblueIcon',
                styleCircle: {
                    // Прозрачность заливки.
                    fillColor: "#00C6FF",
                    // Прозрачность заливки.
                    fillOpacity: 0.3,
                    // Цвет обводки.
                    strokeColor: "#00bff6",
                    // Прозрачность обводки.
                    strokeOpacity: 0.5,
                    // Ширина обводки в пикселях.
                    strokeWidth: 1
                },
                items: [

                ],
                placemarkCollection: null,
                circleCollection: null
            },
            {
                name: "TasksChart",
                style: 'islands#orangeIcon',
                styleCircle: {
                    // Прозрачность заливки.
                    fillColor: "#f0c85e",
                    // Прозрачность заливки.
                    fillOpacity: 0.3,
                    // Цвет обводки.
                    strokeColor: "#efbd81",
                    // Прозрачность обводки.
                    strokeOpacity: 0.5,
                    // Ширина обводки в пикселях.
                    strokeWidth: 1
                },
                items: [

                ],
                placemarkCollection: null,
                circleCollection: null
            }
        ];

        /*]]>*/
    </script>

    <!--MAP CONFIGURE-->
    <script th:inline="javascript">
        /*<![CDATA[*/

        var zoomByClick = 14;

        var myMap;

        function recenterMap(xA,yA,zoom) {
            try{
                //check is zoom less then 
                myMap.setCenter([xA,yA], myMap.getZoom() < zoom ? zoom : myMap.getZoom(), {
                    checkZoomRange: true,
                    duration: 1000
                });
            } catch(e) {
                console.log(e.toString());
            }
        }

        function selectMarkOnMap(type, id) {
                var groupIndex = getGroupIndex(type);
                var mark = null;

                if(groups[groupIndex].placemarkCollection==null) {
                    console.log("WARN: Collection:"+type + " id empty. SearchId:"+id);
                    return;
                }

                try{
                    var iterator = groups[groupIndex].placemarkCollection.getIterator(),
                        object, durind=0;
                    while (object = iterator.getNext()) {
                        if (object['properties'].get('id')==id) {
                            mark = groups[groupIndex].placemarkCollection.get(durind);
                            break;
                        }
                        durind++;
                    }

                    mark.balloon.open();

                } catch (e){console.log(e.toString());}
//            return mark;
        }

        function getGroupIndex(group) {
            switch (group) {
                case "GeoPoints":
                    return 0;
                    break;
                case "TasksOwner":
                    return 1;
                    break;
                case "TasksLocal":
                    return 2;
                    break;
                case "TasksSubscribed":
                    return 3;
                    break;
                case "TasksRecent":
                    return 4;
                    break;
                case "TasksChart":
                    return 5;
                    break;
                default:
                    console.log("Unknown type of Tasks for refresh!");
                    return -1;
                    break;
            }
        }

        function getCircleByCoords(group, x, y) {
            var groupIndex = getGroupIndex(group);

            var circle = null;
            try{
                var iterator = groups[groupIndex].circleCollection.getIterator(),
                    object, durind=0;
                while (object = iterator.getNext()) {
                    if (object.geometry.getCoordinates()[0]==x && object.geometry.getCoordinates()[1]==y) {
                        circle = groups[groupIndex].circleCollection.get(durind);
                        break;
                    }
                    durind++;
                }
            } catch (e){console.log(e.toString());}
            return circle;
        }

        function baloonTaskOpen(event, type) {
            var coords,
                durPlaceMark,
                circle;
            try{
                durPlaceMark = event.get('target');
                coords = durPlaceMark.geometry._coordinates;

                circle = getCircleByCoords(type, coords[0], coords[1]);

                replaceTaskContent(durPlaceMark['properties'].get('id'), coords[0], coords[1],
                    circle == null ? defaultGeoRadius :circle.geometry.getRadius(), durPlaceMark['properties'].get('balloonContent'));

                $("#sidebar-wrapper-right").toggleClass("active", true);

                setDisplayList("changeTaskForm",true);

            } catch (e){console.log(e.toString());}

            recenterMap(coords[0],coords[1],zoomByClick);

            setViewTaskButton();

            try{
                if(placemarkYour!=null){
                    if(placemarkYour.options._options.visible == true) {
                        isTrustedClose = false;
                        placemarkYour.balloon.close();
                    }
                }
            }catch(e){console.log(e.toString())}

        }

        function refreshMAP(groupChangedIndex) {

            if(groupChangedIndex==null || groupChangedIndex==-1){
                for (var i = 0, l = groups.length; i < l; i++) {
                    createMenuGroup(groups[i]);
                }
            } else {
                createMenuGroup(groups[groupChangedIndex]);
            }

            function createMenuGroup (group) {
                // Коллекция для геообъектов группы.

                group.placemarkCollection = new ymaps.GeoObjectCollection({}, {
                    preset: group.style/*,
                    strokeWidth: 4,
                    geodesic: true*/
                });
                // Добавляем коллекцию на карту.
                myMap.geoObjects.add(group.placemarkCollection);

                // Коллекция для окружностей группы.
                group.circleCollection = new ymaps.GeoObjectCollection({}/*, {
                    preset: group.style,
                    strokeWidth: 4,
                    geodesic: true
                }*/);
                // Добавляем коллекцию на карту.
                myMap.geoObjects.add(group.circleCollection);

                for (var j = 0, m = group.items.length; j < m; j++) {
                    createSubMenu(group, group.items[j], group.placemarkCollection,group.circleCollection);
                }

                try{
//                    group.circleCollection.options.cursor = initial;
                    $(group.circleCollection).off("click");
                } catch (e) {console.log(e.toString());}

                switch(group.name){
                    case "GeoPoints":
                        group.placemarkCollection.events
                            .add('mouseenter', function (e) {
                                try{
                                    // Ссылку на объект, вызвавший событие,
                                    // можно получить из поля 'target'.
                                    e.get('target').options.set('preset', 'twirl#storehouseIcon');
                                } catch (e) {console.log(e);}
                            })
                            .add('balloonopen', function (event) {
                                // ваши действия
                                // myMap.balloon.close();
                                // event.get('target').ballon.open();
//                this.coords;
//                var coords = event.get('coords');
                                var coords,
                                    durPlaceMark,
                                    circle;
                                try{
//                                    durPlaceMark = event.originalEvent.target;
                                    durPlaceMark = event.get('target')
                                    coords = durPlaceMark.geometry._coordinates;

                                    circle = getCircleByCoords(group.name, coords[0], coords[1]);

                                    refreshChangeGeoPointForm(
                                        durPlaceMark['properties'].get('id'),
                                        coords[0], coords[1],
                                        circle == null ? defaultGeoRadius : circle.geometry.getRadius(),
                                        durPlaceMark['properties'].get('balloonContent'),
                                        true);

                                    setDisplayList("addGeoPointForm",true);

                                } catch (e){console.log(e.toString());}

                                recenterMap(coords[0],coords[1],zoomByClick);
                                //UPDATE DELETE
                                setUpdateDeleteButtons();

                                try{
                                    if(placemarkYour!=null){
                                        placemarkYour.options._options.visible;

                                        placemarkYour._options.visible;

                                        placemarkYour.options.visible;

                                        if(placemarkYour.options._options.visible == true) {
                                            isTrustedClose = false;
                                            placemarkYour.balloon.close();
                                        }
                                    }

                                }catch(e){console.log(e.toString())}

                            })
                            .add('balloonclose', function (event) {
//                                if(!updating)
                                    closeChangingGeoPoint();
                            });
                        break;
                    case "TasksOwner":
                    case "TasksLocal":
                    case "TasksSubscribed":
                    case "TasksRecent":
                    case "TasksChart":
                        group.placemarkCollection.events.add('mouseenter', function (e) {
                            try{
                                // Ссылку на объект, вызвавший событие,
                                // можно получить из поля 'target'.
                                e.get('target').options.set('preset', 'islands#whiteIcon');
                            } catch (e) {console.log(e);}
                        })
                        .add('balloonopen', function (event) {

                            baloonTaskOpen(event, group.name);

                        })
                        .add('balloonclose', function (event) {
                            closeChangingTask();
                        });
                        break;

                    default:
                        console.log("Unknown type refresh Map!")
                        return;
                        break;
                }
                group.placemarkCollection.events.add('mouseleave', function (e) {
                    try{
                        e.get('target').options.unset('preset');
                    } catch (e) {console.log(e);}
                });

            }

            function createSubMenu (group, item, placemarkCollection, circleCollection) {
                //// ID FROM item.id  CHECK
                var placemark = new ymaps.Placemark([item.latitude, item.longitude],{id: item.id}, { balloonContent: item.name});

                var newContent;
                try{
                    ymaps.geocode(placemark.geometry.getCoordinates(), {
                        results: 1
                    }).then(function (res) {
                        newContent = res.geoObjects.get(0) ?
                            res.geoObjects.get(0).properties.get('name') :
                            'Не удалось определить адрес.';

                        // Задаем новое содержимое балуна в соответствующее свойство метки.
                        switch (getGroupIndex(group.name)) {
                            case 0:
                                placemark.properties.set('balloonContent', item.descr==null||item.descr==="" ? "Адрес: " + newContent : item.descr);
                                break;
                            case 1:
                            case 2:
                            case 3:
                            case 4:
                            case 5:
                                placemark.properties.set('balloonContent', item.theme==null||item.theme==="" ? "Адрес: " + newContent : item.theme);
                                break;
                        }
                    });
                }catch(e){console.log(e.toString())}
                // Добавляем метку в коллекцию.
                placemarkCollection.add(placemark);

//                // Создаем экземпляр класса геометрии круга (указываем координаты и радиус в метрах).
//                var circleGeometry = new ymaps.geometry.Circle([item.latitude, item.longitude], item.radius),
//                // Создаем экземпляр класса геообъекта и передаем нашу геометрию в конструктор.
//                    circleGeoObject = new ymaps.GeoObject({ geometry: circleGeometry });

                var circleGeoObject = new ymaps.Circle(
                    [
                        [item.latitude, item.longitude], item.radius
                    ],
                    {
                        // Описываем свойства круга.
                        // Содержимое балуна.
                        //                        balloonContent: "Радиус круга - 10 км",
                        // Содержимое хинта.
                        //                        hintContent: "Подвинь меня"
                    }, {
                        interactivityModel: "default#transparent",
                        // Задаем опции круга.
                        // Включаем возможность перетаскивания круга.
                        //                        draggable: true,
                        // Цвет заливки.
                        // Последний байт (77) определяет прозрачность.
                        // Прозрачность заливки также можно задать используя опцию "fillOpacity".
                        fillColor: group.styleCircle.fillColor,
                        // Прозрачность заливки.
                        fillOpacity: group.styleCircle.fillOpacity,
                        // Цвет обводки.
                        strokeColor: group.styleCircle.strokeColor,
                        // Прозрачность обводки.
                        strokeOpacity: group.styleCircle.strokeOpacity,
                        // Ширина обводки в пикселях.
                        strokeWidth: group.styleCircle.strokeWidth,

                    }
                );

                // Добавляем окружность в коллекцию.
                circleCollection.add(circleGeoObject);

            }
        }

        function closeEditForms() {
            closeChangingGeoPoint();

            closeChangingTask();

            //closeeditRoute
        }

        var placemarkYour, circleYour, isTrustedClose = true;

        ymaps.ready(function () {
            // Создание экземпляра карты.
            if(ymaps==null){alert("Can't connect to maps")}
            myMap = new ymaps.Map('map', {
                    center: [59.93, 30.32],
                    zoom: 13
                }, {
                    searchControlProvider: 'yandex#search'
                });
            //Getting list of geopoints
            if($('#geoPointListBlock').children().length==0) {
                refreshGeoPointsList();
            }

        /*    var yellowCollection = new ymaps.GeoObjectCollection(null, {
                    preset: 'islands#yellowIcon'
                }),
                blueCollection = new ymaps.GeoObjectCollection(null, {
                    preset: 'islands#blueIcon'
                }),
                // Создаём макет содержимого.
                MyIconContentLayout = ymaps.templateLayoutFactory.createClass(
                    '<div style="color: #FFFFFF; font-weight: bold;">$[properties.iconContent]</div>'
                ),*/
        /*var myPlacemark = new ymaps.Placemark(myMap.getCenter(), {
                hintContent: 'Собственный значок метки',
                balloonContent: 'Это красивая метка'
            }, {
                // Опции.
                // Необходимо указать данный тип макета.
                                        iconLayout: 'default#image'
                //,
                //                         Своё изображение иконки метки.
                //                        iconImageHref: 'images/myIcon.gif',
                // Размеры метки.
                //                        iconImageSize: [30, 42],
                // Смещение левого верхнего угла иконки относительно
                // её "ножки" (точки привязки).
                //                        iconImageOffset: [-5, -38]
            });*/
        /*,
            myPlacemarkWithContent = new ymaps.Placemark([55.661574, 37.573856], {
                hintContent: 'Собственный значок метки с контентом',
                balloonContent: 'А эта — новогодняя',
                iconContent: '12'
            }, {
                // Опции.
                // Необходимо указать данный тип макета.
                iconLayout: 'default#imageWithContent',
                // Своё изображение иконки метки.
                //                        iconImageHref: 'images/ball.png',
                // Размеры метки.
                //                        iconImageSize: [48, 48],
                // Смещение левого верхнего угла иконки относительно
                // её "ножки" (точки привязки).
                //                        iconImageOffset: [-24, -24],
                // Смещение слоя с содержимым относительно слоя с картинкой.
                //                        iconContentOffset: [15, 15],
                // Макет содержимого.
                iconContentLayout: MyIconContentLayout
            })
            ,
            yellowCoords = [[55.73, 37.75], [55.81, 37.75]],
            blueCoords = [[55.73, 37.65], [55.81, 37.65]];


        for (var i = 0, l = yellowCoords.length; i < l; i++) {
            yellowCollection.save(new ymaps.Placemark(yellowCoords[i]));
        }
        for (var i = 0, l = blueCoords.length; i < l; i++) {
            blueCollection.save(new ymaps.Placemark(blueCoords[i]));
        }

        myMap.geoObjects.save(yellowCollection).save(blueCollection);
        */
        /*myMap.geoObjects
        .add(myPlacemark);
        .save(myPlacemarkWithContent);*/

            function hideYourPlaceholder() {
                if(placemarkYour==null||placemarkYour.options._options.visible == false) {
                    console.log("YourPlacemark is always hidden or not exist!");
                    return;
                }
                try{
//                    placemarkYour.balloon.close();
                    placemarkYour.options.set('visible', false);
                    placemarkYour.properties.set('balloonContent',  "");

                    circleYour.geometry.setRadius(defaultGeoRadius);
                    circleYour.options.set('visible', false);
                }catch(e){console.log(e.toString())}
            }

            function createYourTappedPoint(coords) {

                // Создаем метку.
                placemarkYour = new ymaps.Placemark([coords[0].toPrecision(6), coords[1].toPrecision(6)], {
                    // balloonContent: '<img src="http://img-fotki.yandex.ru/get/6114/82599242.2d6/0_88b97_ec425cf5_M" />',
                    iconContent: "Новое"
                }, {
                    preset: "islands#nightStretchyIcon",
                    // Отключаем кнопку закрытия балуна.
//                            balloonCloseButton: false,
                    // Балун будем открывать и закрывать кликом по иконке метки.
                    hideIconOnBalloonOpen: false
                });

//                // Создаем экземпляр класса геометрии круга (указываем координаты и радиус в метрах).
//                var circleGeometry = new ymaps.geometry.Circle([coords[0].toPrecision(6), coords[1].toPrecision(6)], defaultGeoRadius);
//                // Создаем экземпляр класса геообъекта и передаем нашу геометрию в конструктор.
//                circleYour = new ymaps.GeoObject({ geometry: circleGeometry });

                circleYour = new ymaps.Circle(
                    [
                        [coords[0].toPrecision(6), coords[1].toPrecision(6)], defaultGeoRadius
                    ],
                    {
                        // Описываем свойства круга.
                        // Содержимое балуна.
                        //                        balloonContent: "Радиус круга - 10 км",
                        // Содержимое хинта.
                        //                        hintContent: "Подвинь меня"
                    }, {
                        interactivityModel: "default#transparent",
                        // Задаем опции круга.
                        // Включаем возможность перетаскивания круга.
                        //                        draggable: true,
                        // Цвет заливки.
                        // Последний байт (77) определяет прозрачность.
                        // Прозрачность заливки также можно задать используя опцию "fillOpacity".
                        fillColor: "#0098c1",
                        // Прозрачность заливки.
                        fillOpacity: 0.3,
                        // Цвет обводки.
                        strokeColor: "#008eb5",
                        // Прозрачность обводки.
                        strokeOpacity: 0.5,
                        // Ширина обводки в пикселях.
                        strokeWidth: 1
                    }
                );

                /*Refresh form on OPENING BALOON*/
                placemarkYour.events.add('balloonopen',function (e) {
                    e.preventDefault();
                    console.log("your baloon opened");
                    var coords = placemarkYour.geometry.getCoordinates();
                    try {
                        refreshChangeGeoPointForm(-1,
                            coords[0],
                            coords[1],
                            circleYour == null ? defaultGeoRadius :circleYour.geometry.getRadius(),
                            placemarkYour['properties'].get('balloonContent'),
                            true);

                        replaceTaskContent(placemarkYour.id, coords[0], coords[1],
                            circleYour == null ? defaultGeoRadius :circleYour.geometry.getRadius(),
                            placemarkYour['properties'].get('balloonContent'));

                        messageToAddPlace();


                    } catch (e) {
                        console.log(e);
                    }
                    recenterMap(coords[0],coords[1],zoomByClick);
                    setCreateCancelButtons();
                    setCreateTaskButton();
                });

                /*HIDE PLACEMARK ON CLOSING BALOON*/
                placemarkYour.events.add('balloonclose',function (e) {
                    e.preventDefault();
                    console.log("your baloon closed");
                    hideYourPlaceholder();

                    if(isTrustedClose) {
                        closeEditForms();
                        return;
                    }
                    isTrustedClose = true;
                });

                myMap.geoObjects.add(placemarkYour);
                myMap.geoObjects.add(circleYour);
            }

            // Обработка события, возникающего при щелчке
            // левой кнопкой мыши в любой точке карты.
            // При возникновении такого события откроем балун.
            myMap.events.add('click', function (e) {
                if (!myMap.balloon.isOpen() && (placemarkYour == null || placemarkYour.options._options.visible == false)) {
                    var coords = e.get('coords');

                    if(placemarkYour==null&&circleYour==null){

                        createYourTappedPoint(coords);

                    }else{
                        placemarkYour.geometry.setCoordinates([coords[0].toPrecision(6), coords[1].toPrecision(6)]);
                        placemarkYour.options.set('visible', true)

                        circleYour.geometry.setCoordinates([coords[0].toPrecision(6), coords[1].toPrecision(6)]);
                        circleYour.options.set('visible', true)
                    }

                    var newContent;
                    try{
                        ymaps.geocode(placemarkYour.geometry.getCoordinates(), {
                            results: 1
                        }).then(function (res) {
                            newContent = res.geoObjects.get(0) ?
                                res.geoObjects.get(0).properties.get('name') :
                                'Не удалось определить адрес.';

                            // Задаем новое содержимое балуна в соответствующее свойство метки.
                            placemarkYour.properties.set('balloonContent',  newContent);
//                            placemarkYour.balloon.setData({ content: ''+newContent });
                        });
                    }catch(e){console.log(e.toString())}
//                    console.log(placemarkYour.properties.get('balloonContent'));
                    console.log(placemarkYour['properties'].get('balloonContent'));

                    //placemarkYour.balloon.open();
                }
                else {

                    myMap.balloon.close();

                    hideYourPlaceholder();
                }
            });

        });
        /*]]>*/
    </script>
</div>

<!--WRAPPER MENUS-->
<div th:replace="fragments/wrappermenu :: wrappermenu"> </div>

<!--EVENT ON ELEM IN LIST CLICKED-->
<script th:inline="javascript">
    // <![CDATA[
    //        $('li.elem-in-list').on('click',
    function setEventElemsInList(event, ob) {
        var id = $(ob).find('span.elem-in-list-id').text(),
            check = "elemFromList-",
            cls = $(ob).attr('class').split(' '),
            type = "";
//        for (var i = 0; i < cls.length; i++) {
//            // Iterate over the class and log it if it matches
//            if (cls[i].indexOf(check) > -1) {
//                type = (cls[i].slice(check.length, cls[i].length));
//                console.log("Check mark with type:" + type + " and id:"+id);
//                break;
//            }
//        }

        var cls = $.map(cls, function (val, i) {
            if (val.indexOf(check) > -1) {
                return val.slice(check.length, val.length)
            }
        });
        console.log(type=cls.join(' '));

        selectMarkOnMap(type,id);
    };
    /*]]>*/
</script>

<!--EVENTS LISTS IN LEFT MENU-->
<script th:inline="javascript">
    // <![CDATA[

    function toggleList(elemName) {
        switch (elemName){
            case "geoPointList":
                $('#geoPointListBlock').toggle("fast");
                break;
            case "routeList":
                break;
            case "tasksList":
                $('#tasksBlock').toggle("fast");
                break;
            case "addGeoPointForm":
                $('#add-geo_point-form').toggle("fast");
                break;
            case "changeTaskForm":
                $('#change-task-form').toggle("fast");
                break;
        }
    }

    function setDisplayList(elemName,bool) {
        if(bool===true){
            switch (elemName){
                case "geoPointList":
                    $('#geoPointListBlock').show("fast");
                    break;
                case "routeList":
                    break;
                case "myTaskList":
                    break;
                case "addGeoPointForm":
                    $('#add-geo_point-form').show("fast");
                    break;
                case "changeTaskForm":
                    $('#change-task-form').show("fast");
                    break;
            }
        } else if(bool===false) {
            switch (elemName){
                case "geoPointList":
                    $('#geoPointListBlock').hide("fast");
                    break;
                case "routeList":
                    break;
                case "myTaskList":
                    break;
                case "addGeoPointForm":
                    $('#add-geo_point-form').hide("fast");
                    break;
                case "changeTaskForm":
                    $('#change-task-form').hide("fast");
                    break;
            }
        }

    }

    $(document).ready(function() {
        $('.changeGeoPointsButton').click(function (e) {
            toggleList("addGeoPointForm");
        });

        $('.getGeoPointsButton').click(function (e) {

            if($('#geoPointListBlock').children().length==0){
                refreshGeoPointsList();
            }

//            $(this).off("click").click(function (e) {
                toggleList("geoPointList");
//            });
        });

        $('.getTasksListButton').click(function (e) {
            toggleList("tasksList");
        });

        $(".check-box-task-lists").change(function() {
            // this will contain a reference to the checkbox
            if (this.checked) {
                // the checkbox is now checked
                refreshTasksList(this.value);
            } else {
                // the checkbox is now no longer checked
                deleteCustomListFromMenu(this.value);
                deleteMarksFromMap(this.value);
            }
        });

//        $('#getTasksOwnerButton').click(function (e) {
////            if($('#tasksListBlock').children().length==0){
//                refreshTasksList("TasksOwner");
////            }
//        });
//
//        $('#getTasksLocalButton').click(function (e) {
////            if($('#tasksListBlock').children().length==0){
//                refreshTasksList("TasksLocal");
////            }
//        });
//
//        $('#getTasksSubscribedButton').click(function (e) {
////            if($('#tasksListBlock').children().length==0){
//                refreshTasksList("TasksSubscribed");
////            }
//        });
//
//        $('#getTasksRecentButton').click(function (e) {
////            if($('#tasksListBlock').children().length==0){
//            refreshTasksList("TasksRecent");
////            }
//        });
//        $('#getTasksChartButton').click(function (e) {
////            if($('#tasksListBlock').children().length==0){
//            refreshTasksList("TasksChart");
////            }
//        });
    });
    /*]]>*/
</script>

<!--<div th:replace="fragments/mapfragments :: messages">Page Content</div>-->
<!--<th:block layout:fragment="script">-->
    <!--<h2>Static content for prototyping purposes only</h2>-->
<!--</th:block>-->


<!-- ---MESSAGES--- -->

<!--Message on success creating/updating-->
<div id="responseBlockSuccess" class="Message Message--green is-hidden">
    <div class="Message-icon">
        <i class="fa fa-check"></i>
    </div>
    <div id="responseMessageSuccess" class="Message-body">
        <p>This is a message telling you that everything is a-okay!</p>
        <p>Good job, and good riddance.</p>
    </div>
    <button class="Message-close js-messageClose"><i class="fa fa-times"></i></button>
</div>

<!--message on Removing-->
<div id="responseBlockWarning"  class="Message Message--orange is-hidden">
    <div class="Message-icon">
        <i class="fa fa-exclamation"></i>
    </div>
    <div id="responseMessageWarning"  class="Message-body">
        <p>This is a simple notification with a brighter color...</p>
        <p>If you bring you mouse here you can close it manually.</p>
    </div>
    <button class="Message-close js-messageClose"><i class="fa fa-times"></i></button>
</div>

<!--message on Error-->
<div id="responseBlockError"  class="Message Message--red is-hidden">
    <div class="Message-icon">
        <i class="fa fa-times"></i>
    </div>
    <div id="responseMessageError" class="Message-body">
        <p>This is a notification that something went wrong...</p>
        <!--<button class="Message-button" id="js-helpMe">Yikes, help me please!</button>-->
        <!--<button class="Message-button js-messageClose">Don't care.</button>-->
    </div>
    <button class="Message-close js-messageClose"><i class="fa fa-times"></i></button>
</div>

<!--message after tap on map-->
<div id="message-add_place" class="Message is-hidden">
    <div class="Message-icon">
        <i class="fa fa-bell-o"></i>
    </div>
    <div class="Message-body">
        <p>Выберите место для дальнейшего действия!
            <small><br>Добавьте новое место или задание!</small>
        </p>
        <button class="Message-button" id="js-showMeGeo">Добавить место!</button>
        <button class="Message-button" id="js-showMeTask">Добавить задание!</button>
    </div>
    <button class="Message-close js-messageClose"><i class="fa fa-times"></i></button>
</div>

<!--Message in top for start-->
<div id="message-info"  class="Message is-hidden">
    <div class="Message-icon">
        <i class="fa fa-bell-o"></i>
    </div>
    <div class="Message-body">
        <p id="info-message-top">Рады приветствовать Вас!</p>
        <p class="u-italic">Кликните по карте и выберите место для начала работы!</p>
    </div>
    <button class="Message-close js-messageClose"><i class="fa fa-times"></i></button>
</div>

<!--EVENTS CONTROLS for messages-->
<script th:inline="javascript">
    /*<![CDATA[*/
    var responseBlockSuccess, responseBlockWarning, responseBlockError, mesageToAdd;

    function closeMessage(el) {
        el.addClass('is-hidden');
    }

    function showResponseMessage(type, text) {
        switch(type) {
            case "created":
            case "updated":
                $('#responseMessageSuccess').text(text);
                responseBlockSuccess.removeClass('is-hidden');
                setTimeout(function() {
                    closeMessage(responseBlockSuccess);
                }, 7000);
                break;
            case "removed":
                $('#responseMessageWarning').text(text);
                responseBlockWarning.removeClass('is-hidden');
                setTimeout(function() {
                    closeMessage(responseBlockWarning);
                }, 7000);
                break;
            case "error":
                $('#responseMessageError').text(text);
                responseBlockError.removeClass('is-hidden');
                setTimeout(function() {
                    closeMessage(responseBlockError);
                }, 7000);
                break;
            default:
                alert("Unknown Type of response type to show message!")
                break;
        }
    }

    function messageToAddPlace() {
        mesageToAdd.removeClass('is-hidden');
        setTimeout(function() {
            closeMessage(mesageToAdd);
        }, 15000);
    }

    $(document).ready(function() {
        mesageToAdd = $('#message-add_place');
        responseBlockSuccess = $('#responseBlockSuccess');
        responseBlockWarning = $('#responseBlockWarning');
        responseBlockError = $('#responseBlockError');

        $('.js-messageClose').on('click', function(e) {
            closeMessage($(this).closest('.Message'));
            setDisplayList("addGeoPointForm",false);
            setDisplayList("changeTaskForm",false);
        });

        $('#js-showMeGeo').on('click', function(e) {
            $("#sidebar-wrapper-right").toggleClass("active", true);
            setCreateCancelButtons();
            setCreateTaskButton();
            setDisplayList("addGeoPointForm",true);
            closeMessage($(this).closest('.Message'));
        });

        $('#js-showMeTask').on('click', function(e) {
            $("#sidebar-wrapper-right").toggleClass("active", true);
            setCreateTaskButton();
            setCreateCancelButtons();
            setDisplayList("changeTaskForm",true);
            closeMessage($(this).closest('.Message'));
        });

        $('#message-info').removeClass('is-hidden');
        setTimeout(function() {
            closeMessage($('#message-info'));
        }, 10000);

    });
    /*]]*/
</script>

<!-- ---END MESSAGES--- -->

<!--GEOPOINTS CRUD + BUTTONS GEOFORM-->
<script th:inline="javascript">
    // <![CDATA[

    var createUpdateGeoButton;
    var deleteCancelGeoButton;
    var defaultGeoRadius = 300;

    $(document).ready(function() {
        createUpdateGeoButton = $("#geo_point-create_update-button");
        deleteCancelGeoButton = $("#geo_point-delete_cancel-button");
        createViewTaskButton = $("#task-create_view-button");
    });

    function setCreateCancelButtons() {
//        $(createUpdateGeoButton).prop('value', 'Create');
//        $(deleteCancelGeoButton).prop('value', 'Cancel');
        $(createUpdateGeoButton).html('Создать');
        $(deleteCancelGeoButton).html('Отменить');

        $(createUpdateGeoButton).prop("type", "submit");
        $(deleteCancelGeoButton).prop("type", "button");

        $(createUpdateGeoButton).off("click").click(function (e) {
            e.preventDefault();
            submitCreateGeoPoint();
//            submitGeoPointForm(/*[[@{/secure/geopoint/create}]]*/'/secure/geopoint/create','POST');
//            submitGeoPointForm(/*[[@{/secure/api/geo/byEmail}]]*/'/secure/api/geo/byEmail','POST');
        });
        $(deleteCancelGeoButton).off("click").click(function (e) {
            e.preventDefault();
            closeChangingGeoPoint();
        });
    }

    function setUpdateDeleteButtons() {
//        $(createUpdateGeoButton).prop('value', 'Update');
//        $(deleteCancelGeoButton).prop('value', 'Delete');
//        createUpdateGeoButton.textContent = "Update";
//        deleteCancelGeoButton.textContent = "Delete";
        $(createUpdateGeoButton).html('Обновить');
        $(deleteCancelGeoButton).html('Удалить');

        $(createUpdateGeoButton).prop("type", "submit");
        $(deleteCancelGeoButton).prop("type", "submit");

        $(createUpdateGeoButton).off("click").click(function (e) {
            e.preventDefault();
            submitUpdateGeoPoint();
//            submitGeoPointForm(/*[[@{/secure/geopoint/update}]]*/'/secure/geopoint/update','PATCH');
//            submitGeoPointForm(/*[[@{/secure/api/geo}]]*/'/secure/api/geo','PATCH');
        });
        $(deleteCancelGeoButton).off("click").click(function (e) {
            e.preventDefault();
            submitDeleteGeoPoint();
//            submitGeoPointForm(/*[[@{/secure/api/geo/byObj}]]*/'/secure/api/geo/byObj','DELETE');
        });
    }

    function getData() {
        var data = {}
        data["id"] = $("#input-geo_point-id").val();
        data["descr"] = $("#input-geo_point-descr").val();
        data["latitude"] = $("#input-geo_point-latitude").val();
        data["longitude"] = $("#input-geo_point-longitude").val();
        data["radius"] = $("#input-geo_point-radius").val();
        return data;
    }

    function submitCreateGeoPoint() {
        var action =/*[[@{/secure/api/geo}]]*/'/secure/api/geo';

        console.log('ajax submitGeoPointForm()');

        var data = getData();
/*try{
    frmjs = JSON.stringify(data);
}catch(e){console.log(e)}*/
        $.ajax({
            url: action,
            type: 'POST',
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            timeout: 600000,
            async: true,
            beforeSend: function(request) {
                request.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
            },
            success: function (response) {
                // if the response contains any errors, replace the form
                if ($(response).find('.has-error').length) {
                    var msg = "Sorry but there was an error: ";
                    showResponseMessage("error", msg+response.message);
                } else {
                    showResponseMessage("created", response.message);
                    refreshGeoPointsList();
//                    isTrustedClose = false;
                    placemarkYour.balloon.close();
                }
            },
            error :function(response) {
                var msg = "Sorry but there was an error: ";
                showResponseMessage("error", msg+response.message);
            }
        });

    }

    function submitUpdateGeoPoint() {
        var url = /*[[@{/secure/api/geo}]]*/'/secure/api/geo';
        console.log('ajax submitGeoPointForm()');

        var data = getData();
        /*try{
            frmjs = JSON.stringify(data);
            frmjs = data.serialize();
        }catch(e){console.log(e)}*/
        $.ajax({
            url: url,
            type: 'PATCH',
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            timeout: 600000,
            async: true,
            beforeSend: function(request) {
                request.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
            },
            success: function (response) {
                // if the response contains any errors, replace the form
                if ($(response).find('.has-error').length) {
                    var msg = "Sorry but there was an error: ";
                    showResponseMessage("error", msg+response.message);
                } else {
                    showResponseMessage("updated", response.message);
                    refreshGeoPointsList();
                }
            },
            error :function(response) {
                var msg = "Sorry but there was an error: ";
                showResponseMessage("error", msg+response.message);
            }
        });

    }

    function submitDeleteGeoPoint() {
        var url = /*[[@{/secure/api/geo?id=}]]*/'/secure/api/geo?id=';
            url += $('#input-geo_point-id').val();

        $.ajax({
            type : "DELETE",
            url : url,
            data: {},
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            timeout: 600000,
            async: true,
            beforeSend: function(request) {
                request.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
            },
            success : function(response) {
                if ($(response).find('.has-error').length) {
                    var msg = "Sorry but there was an error: ";
                    showResponseMessage("error", msg+response.message);
                } else {
                    showResponseMessage("removed", response.message);
                    refreshGeoPointsList();
                }
            },
            error :function(response) {
                var msg = "Sorry but there was an error: ";
                showResponseMessage("error", msg+response.message);
            }
        });
    }

    function submitGeoPointForm(action,type){

        var form = $('#geo_point-form');
        $(form).attr("action", action);
        $(form).attr("method", type);

        console.log('ajax submitGeoPointForm()');

        var frmjs = form.serialize();
        //frmjs = JSON.stringify(form);

        $.ajax({
            url: action,
            type: type,
            contentType: "application/json",

            data: type!="PATCH" ? form.serialize():{status: form.serialize(), _method: "PATCH"},
//            data: JSON.stringify(data),
            dataType: "json",
            timeout: 600000,
            async: true,
            beforeSend: function(request) {
                request.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
            },
            success: function (response) {
                // if the response contains any errors, replace the form
                if ($(response).find('.has-error').length) {
                    var msg = "Sorry but there was an error: ";
                    showResponseMessage("error", msg+response.message);
                } else {
                    showResponseMessage("removed", msg+response.message);
                }
            },
//            error :function(XMLHttpRequest, textStatus, errorThrown) {
            error :function(response) {
                var msg = "Sorry but there was an error: ";
                showResponseMessage("error", msg+response.message);
            }
        });

//        refreshGeoPointsList();
    }

    /*$(document).ready(function() {
        $('#input-geo_point-radius').on('onchange',function (e) {

        });
    });*/
    // ]]>
</script>

<!--GEOPOINTS LIST GET + GEO FORM-->
<script th:inline="javascript">
    /*<![CDATA[*/

    function refreshChangeGeoPointForm(id,x,y,R,T,bool) {

        document.getElementById('input-geo_point-id').value = id;
        document.getElementById('input-geo_point-latitude').value = x;
        document.getElementById('input-geo_point-longitude').value = y;
        document.getElementById('input-geo_point-radius').value = R;
        document.getElementById('input-geo_point-descr').value = T;

        $("#sidebar-wrapper-right").toggleClass("active", bool);

        $("#responseMessage").text('');

    }

    function closeChangingGeoPoint() {
        refreshChangeGeoPointForm(null,null,null,defaultGeoRadius,"",false);

        //CREATE CANCEL
        setCreateCancelButtons();

        setDisplayList("addGeoPointForm",false);
    }

    function filterListGeoResponse(response){
        var geoListBlock = $('#geoPointListBlock');
        var responseAsObject;

        responseAsObject = $.parseJSON(response);
        var htmlResponse;
        if(responseAsObject.length>0){
            var descr;
            htmlResponse = "<ul class='ListGeoPoints'>";
            for(var i=0; i<responseAsObject.length; i++) {
                descr = (responseAsObject[i].descr==null||responseAsObject[i].descr=="") ?
                    "Моё место" :
                    responseAsObject[i].descr.length>25 ? responseAsObject[i].descr.substr(0, 25)+".." : responseAsObject[i].descr;

                htmlResponse+="<li class='elemFromList-GeoPoints elem-in-list'>";
                htmlResponse+="<span id='geo_point-id-in-list-"+i+"' class='elem-in-list-id' style='display:none;'>";
                htmlResponse+= responseAsObject[i].id+"</span>";
                htmlResponse+= descr+"<br>";
                htmlResponse+= "<span style='display:none;'>latitude "+responseAsObject[i].latitude+"</span>";
                htmlResponse+="<span style='display:none;'>longitude "+responseAsObject[i].longitude+"<br>"+"</span>";
                htmlResponse+="Радиус: "+responseAsObject[i].radius;
                htmlResponse+="</li>";
            }
            htmlResponse+="</ul>";
        } else {
            htmlResponse = "<div class='empty_list'>Добавьте часто посещаемые места</div>"
        }
        return [htmlResponse, responseAsObject];
    }

    function refreshGeoPointsList() {
        var url = /*[[@{/secure/api/geo/geoPointList}]]*/'/secure/api/geo/geoPointList';
/*
        $("#geoPointListBlock").load(url, function (response, status, xhr) {
            console.log('ajax refreshGeoPointsList()');
            if (status == "error") {
                var msg = "Sorry but there was an error: ";
                alert(msg + xhr.status + " " + xhr.statusText);
            } else if (status == "success") {
                var filteredresponse = filterListGeoResponse(response);
                response = filteredresponse[0];
                updateGeoPointsOnMap(filteredresponse[1]);
            }
        });*/

        $.ajax({
            type: "GET",
            dataType: 'html',
            url: url,
            error: function (response) {
                var msg = "Sorry but there was an error: ";
                alert(msg+response.responseText);
            },
            success: function (response) {
                var filteredresponse = filterListGeoResponse(response);

                $("#geoPointListBlock").html(filteredresponse[0]);

                $("#geoPointListBlock").find('li.elem-in-list')
                    .on('click',function (e) {
                        setEventElemsInList(e, this);
                    });

                updateMarksOnMap("GeoPoints", filteredresponse[1]);
            }
        });
    }

    // ]]>
</script>


<!--TASKS BUTTONS-->
<script th:inline="javascript">
    // <![CDATA[
    function replaceTaskContent(id,latitude,longitude,radius,name) {
        document.getElementById('input-task-id').value = id;
        $('#input-task-name').text(name);
//        try{
//            document.getElementById('input-task-latitude').value = latitude;
//            document.getElementById('input-task-longitude').value = longitude;
//            document.getElementById('input-task-radius').value = radius;
//        } catch (e) {console.log(e.toString());}
    }
     /*var changeTaskFormData, viewTaskButton;

    $(document).ready(function() {
        changeTaskFormData = $("#change-task-form-data");
        viewTaskButton = $("#task-view-button");
    });
    function setCreateTaskButton() {
        $(changeTaskFormData).show();
        $(viewTaskButton).hide();
    }

    function setViewTaskButton() {
        $(changeTaskFormData).hide();
        $(viewTaskButton).show();
    }*/

    var createViewTaskButton;

    $(document).ready(function() {
        createViewTaskButton = $("#task-create_view-button");
    });

    function setCreateTaskButton() {
        createViewTaskButton.html("Создать");

        $(createViewTaskButton).off("click").click(function (e) {
            e.preventDefault();
            submitCreateTask();
        });
    }

    function setViewTaskButton() {
        createViewTaskButton.html("Просмотреть");

        $(createViewTaskButton).off("click").click(function (e) {
            e.preventDefault();
            submitViewTask();
        });
    }

    function submitViewTask() {
        var action =/*[[@{/secure/task/}]]*/'/secure/task/';
        action += $('#input-task-id').val();

//        var form = $('#change-task-form-data');
//        form.action = action;
//        $(form).attr("method", "GET");

        window.location.href = action;
    }

    function submitCreateTask() {
        var action =/*[[@{/secure/task/form/withGeo}]]*/'/secure/task/form/withGeo';

//        var form = $('#change-task-form-data');
//        form.action = action;
//        $(form).attr("method", "POST");

        console.log('ajax submitGeoPointForm()');

        var data = getData();
        /*try{
         frmjs = JSON.stringify(data);
         }catch(e){console.log(e)}*/
        $.ajax({
            url: action,
            type: 'POST',
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "html",
            timeout: 600000,
            async: true,
            beforeSend: function(request) {
                request.setRequestHeader([[${_csrf.headerName}]], [[${_csrf.token}]]);
            },
            success: function (response) {

                // if the response contains any errors, replace the form
                if ($(response).find('.has-error').length) {
                    var msg = "Sorry but there was an error: ";
                    showResponseMessage("error", msg+response.message);
                } else {
//                    refreshTasksOwnerList();
//                    isTrustedClose = false;
                    placemarkYour.balloon.close();

//                    var body=$(response).filter('.body-content');
//                    $("body").html(body);

                    $('body').replaceWith(response);
//                    $('html').replaceWith(response);
//                    window.location.href = "secure/taskform/withGeo";
                    window.history.pushState("", "", "secure/taskform/withGeo");
                }
            },
            error :function(response) {
                var msg = "Sorry but there was an error: ";
                showResponseMessage("error", msg+response.message);
            }
        });

    }

    function closeChangingTask() {
        setDisplayList("changeTaskForm",false);
        setCreateTaskButton();
    }

    $('.changeTasksButton').click(function (e) {
        toggleList("changeTaskForm");
    });

    $("#task-cancel-button").click(function (e) {
        closeEditForms();

        $("#sidebar-wrapper-right").toggleClass("active", false);

//        placemarkYour.balloon.close();
    });

    // ]]>
</script>
<!--TASKS-->
<script th:inline="javascript">
    // <![CDATA[

    function filterListTasksOwnerResponse(type, response){
//        var tasksBlock = $('#tasksListBlock');
        var responseAsObject;

        responseAsObject = $.parseJSON(response);
        var htmlResponse;

        if(responseAsObject.length>0){
            var theme,descr;
            htmlResponse = "<ul class='List"+type+"'>";

            for(var i=0; i<responseAsObject.length; i++) {
                theme = (responseAsObject[i].theme==null||responseAsObject[i].theme=="") ?
                    "Задание" :
                    responseAsObject[i].theme.length>25 ? responseAsObject[i].theme.substr(0, 25)+".." : responseAsObject[i].theme,
                    descr = (responseAsObject[i].descr==null||responseAsObject[i].descr=="") ?
                        "Описание отсутствует" :
                        responseAsObject[i].descr.length>25 ? responseAsObject[i].descr.substr(0, 25)+".." : responseAsObject[i].descr;

                htmlResponse+="<li class='elemFromList-"+type+" elem-in-list'>";
                htmlResponse+="<span id='tasks_"+type+"-id-in-list-"+i+"' class='elem-in-list-id' style='display:none;'>";
                htmlResponse+= responseAsObject[i].id+"</span>";
                htmlResponse+= theme + "<br>";
                htmlResponse+= "Описание: "+ descr +"<br>";
                htmlResponse+= "Тип:      "+responseAsObject[i].type+"<br>";
                htmlResponse+= "<span style='display:none;'>latitude "+responseAsObject[i].latitude+"</span>";
                htmlResponse+="<span style='display:none;'>longitude "+responseAsObject[i].longitude+"<br>"+"</span>";
                htmlResponse+="Радиус: "+responseAsObject[i].radius;
                htmlResponse+="</li>";
            }
            htmlResponse+="</ul>";
        } else {
            htmlResponse = "<div class='List";
            switch (type) {
                case "TasksOwner":
                    htmlResponse += type+" empty_list'>Добавьте своё задание!</div>";
                    break;
                case "TasksLocal":
                    htmlResponse += type+" empty_list'>Нет заданий возле ваших мест :(</div>";
                    break;
                case "TasksSubscribed":
                    htmlResponse += type+" empty_list'>Вы не подписаны ни на одно задание :(</div>";
                    break;
                case "TasksRecent":
                    htmlResponse += type+" empty_list'>Нет обновлений в заданиях :(</div>";
                    break;
                case "TasksChart":
                    htmlResponse += type+" empty_list'>Нет заданий :(</div>";
                    break;
                default:
                    htmlResponse += type+" empty_list'>Неверный тип заданий!</div>";                                                                       type+" empty_list'>Добавьте своё место либо задание!</div>"
                    console.log("Unknown type of Tasks for refresh!");
                    return;
                    break;
            }
        }
        return [htmlResponse, responseAsObject];
    }

    function refreshTasksList(type) {
        var url;
        switch (type) {
            case "TasksOwner":
                url = /*[[@{/secure/api/feed/10}]]*/'/secure/api/feed/10';
                break;
            case "TasksLocal":
                url = /*[[@{/secure/api/feed/30}]]*/'/secure/api/feed/30';
                break;
            case "TasksSubscribed":
                url = /*[[@{/secure/api/feed/50}]]*/'/secure/api/feed/50';
                break;
            case "TasksRecent":
                url = /*[[@{/secure/api/feed/20}]]*/'/secure/api/feed/20';
                break;
            case "TasksChart":
                url = /*[[@{/secure/api/feed/40}]]*/'/secure/api/feed/40';
                break;
            default:
                console.log("Unknown type of Tasks for refresh!")
                return;
                break;
        }

        /*
         $("#geoPointListBlock").load(url, function (response, status, xhr) {
         console.log('ajax refreshGeoPointsList()');
         if (status == "error") {
         var msg = "Sorry but there was an error: ";
         alert(msg + xhr.status + " " + xhr.statusText);
         } else if (status == "success") {
         var filteredresponse = filterListGeoResponse(response);
         response = filteredresponse[0];
         updateMarksOnMap("GeoPoints",filteredresponse[1]);
         }
         });*/

        $.ajax({
            type: "GET",
            dataType: 'html',
            url: url,
            error: function (response) {
                var msg = "Sorry but there was an error: ";
                showResponseMessage("error", msg+response.message);
            },
            success: function (response) {
                var filteredresponse = filterListTasksOwnerResponse(type, response);

                deleteCustomListFromMenu(type);

//                $("#tasksListBlock").html(filteredresponse[0]);
                $("#tasksListBlock").append(filteredresponse[0]);

                $("#tasksListBlock").find('li.elemFromList-'+type)
                    .on('click',function (e) {
                        setEventElemsInList(e, this);
                    });

                updateMarksOnMap(type, filteredresponse[1]);
            }
        });
    }

    function deleteCustomListFromMenu(type){
        if(groups!=null && groups.length!=0) {
            var tasksListBlock = $("#tasksListBlock");
            var customList = $(tasksListBlock).find('.List'+type);
            if(customList.length>0) {
                customList.detach();//tasksListBlock
//                customList.remove();
            }
        }
    }

    function deleteMarksFromMap(type){
        if(groups!=null && groups.length!=0) {
            var index = getGroupIndex(type);

            if(groups[index].items.length>0) {
                groups[index].items.length=0;
                myMap.geoObjects.remove(groups[index].placemarkCollection);
                myMap.geoObjects.remove(groups[index].circleCollection);
            }
        }
    }

    function updateMarksOnMap(type, list) {
        if(groups!=null && groups.length!=0) {
            var index = getGroupIndex(type);

            deleteMarksFromMap(type);
//            groups[index].items.length=0;
//            myMap.geoObjects.remove(groups[index].placemarkCollection);
//
//            myMap.geoObjects.remove(groups[index].circleCollection);

            for(var i=0; i<list.length; i++) {
                groups[index].items.push(list[i]);
            }

            refreshMAP(index);
        }
    }

    // ]]>
</script>

</body>
</html>